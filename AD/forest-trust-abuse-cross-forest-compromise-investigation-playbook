# üõ°Ô∏è Incident Response Playbook ‚Äì Bidirectional Forest Trust Abuse

## üìñ Scenario
Two companies have merged and established a **bidirectional Active Directory forest trust**.  
Attackers are exploiting this trust to move laterally, exfiltrate sensitive data, and establish persistence across the combined infrastructure.

This playbook provides **step-by-step investigation methods** and **log source correlation** to detect and analyze adversary activity.

---

## üéØ Investigation Goals
1. Identify how the adversary gained access in the first forest.  
2. Determine how they are abusing the bidirectional trust.  
3. Detect lateral movement and privilege escalation across both forests.  
4. Contain persistence mechanisms and cut off exfiltration channels.  

---

## üß≠ Step 1 ‚Äì Initial Scoping

- **Gather context:**
  - Which forest was compromised first? (Company A or Company B)
  - What trust type is configured?  
    - *Forest-wide authentication* (high risk)  
    - *Selective authentication* (safer but still exploitable if misconfigured)

- **Key Questions:**
  - Are admin accounts being used cross-forest?
  - Is SID History enabled across the trust?

---

## üîç Step 2 ‚Äì Log Sources to Collect & Correlate

| Source | What to Look For |
|--------|------------------|
| **Windows Security Logs (Domain Controllers)** | Event ID 4624 (Logon), 4769 (Kerberos TGS), 4771 (Kerberos pre-auth failures), 4728/4732 (Group membership changes) |
| **Active Directory Replication Logs** | Suspicious replication requests, DCSync (Event ID 4662 with DS-Replication-Get-Changes) |
| **Firewall / Network Logs** | Unusual traffic between forests (Kerberos 88/TCP, LDAP 389, LDAPS 636, SMB 445, RDP 3389) |
| **SIEM Correlation** | Accounts authenticating to both forests within short timeframes |
| **Endpoint Detection (EDR)** | Lateral movement tools (Mimikatz, Rubeus, BloodHound, PowerShell remoting, PsExec) |
| **DNS Logs** | Cross-forest name resolution attempts from unexpected hosts |
| **Proxy / DLP Logs** | Large outbound data transfers, unusual exfil patterns |

---

## üßæ Step 3 ‚Äì Indicators of Abuse

### 1. Authentication Anomalies
- Accounts from **Forest A** suddenly logging into resources in **Forest B** (and vice versa).  
- Logon Type 3 (network) events from unusual subnets.  
- Kerberos ticket requests (Event ID 4769) for cross-forest services.  

### 2. Privilege Escalation
- Group membership changes in **Enterprise Admins** or **Domain Admins** (Event IDs 4728, 4729, 4732, 4733).  
- Creation of new accounts with high privileges.  

### 3. SID History Abuse
- Accounts showing unusual or excessive SIDHistory values.  
- Event ID 4765 / 4766 (SID history added/removed).  

### 4. Replication Abuse
- DCSync attempts (Event ID 4662 with DS-Replication-Get-Changes on DCs).  
- NTDS.dit extraction activity.  

### 5. Persistence & Exfiltration
- Service accounts created in both forests.  
- Scheduled tasks / WMI subscriptions pointing to remote systems.  
- Stealthy outbound connections (HTTP/S, DNS tunneling, SFTP).  

---

## üõ†Ô∏è Step 4 ‚Äì Deep Investigation Methods

### A. Cross-Forest Authentication Tracing
- Correlate **Event ID 4624** (logon) with **4769** (TGS requests) across both forests.  
- Identify accounts authenticating unusually across forests.  

### B. Kerberos Ticket Analysis
- Use tools like **Rubeus** (defense mode) or **klist** to inspect TGT/TGS usage.  
- Look for anomalous Service Principal Names (SPNs).  

### C. Group Membership Timeline
- Pull **4728/4732** logs for the last 30 days from both forests.  
- Build a timeline of **who was added/removed from sensitive groups**.  

### D. Replication Monitoring
- Inspect DC logs for **4662 events** with object type `replicating directory changes`.  
- Look for accounts requesting replication outside normal patterns.  

### E. EDR & Process Correlation
- Hunt for PowerShell commands like:
  - `Invoke-Mimikatz`
  - `Invoke-Kerberoast`
  - `Get-DomainTrust`
- Map to MITRE ATT&CK (T1558, T1482, T1078).  

### F. Network & Proxy Analysis
- Detect abnormal **Kerberos/LDAP traffic** between forests.  
- Identify large data transfers over HTTPS/DNS (possible exfiltration).  

---

## üß© Step 5 ‚Äì Containment Considerations

- **Limit Trust Scope**
  - Switch to **Selective Authentication** if possible.  
  - Review which accounts actually need cross-forest access.  

- **Reset Credentials**
  - Force password resets for any accounts suspected of abuse.  
  - Prioritize **Enterprise Admins, Domain Admins, and service accounts**.  

- **Audit and Remove Persistence**
  - Delete rogue accounts or backdoors.  
  - Check Group Policy Objects (GPOs) for malicious scripts.  

- **Segmentation**
  - Restrict traffic between forests to **only required ports/services**.  

---

## üìä Reporting & Lessons Learned

- Document **initial access vector** (phishing, vulnerability, insider, etc.).  
- Identify which resources were accessed or exfiltrated.  
- Update **SIEM detection rules** for:
  - Cross-forest authentication anomalies  
  - DCSync attempts  
  - Group membership changes  
- Conduct **purple team exercises** to validate new detections.  

---

## üìö References
- [MITRE ATT&CK ‚Äì Abuse of Trusts (T1484.002)](https://attack.mitre.org/techniques/T1484/002/)  
- [Microsoft ‚Äì Monitoring Active Directory Trusts](https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/plan/forest-design-guide)  
- [SpecterOps ‚Äì Forest Trust Attack Paths](https://posts.specterops.io/)  

---
